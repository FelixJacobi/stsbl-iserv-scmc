# src/Stsbl/SchoolCertificateManagerConnectorBundle/Resources/config/services.yml
services:
    stsbl.scmc.menu_listener:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\EventListener\MenuListener # Out MenuListener Class
        tags:
          - { name: kernel.event_listener, event: iserv_portal.menu_main, method: onBuildMainMenu } # Tells IServ about the main menu method
          - { name: kernel.event_listener, event: iserv_portal.menu_admin, method: onBuildAdminMenu } # Tells IServ about the admin menu method

    stsbl.scmc.kernel_response_subscriber:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\EventListener\KernelResponseSubscriber
        arguments: ["@router.default", "@iserv.security_handler", "@session"]
        tags:
          - { name: kernel.event_subscriber }

    stsbl.scmc.security.scmcauth:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Security\ScmcAuth
        arguments: ["@request_stack", "@iserv.security_handler", "@session"]

    stsbl.scmc.admin.userpassword:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Admin\UserPasswordAdmin # Our CRUD class
        arguments: [IServ\CoreBundle\Entity\User]  # Sets the controlled entity class
        tags:
            - { name: iserv.crud } # Tells IServ about our CRUD
            
    stsbl.scmc.admin.server:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Admin\ServerAdmin # Our CRUD class
        arguments: [Stsbl\SchoolCertificateManagerConnectorBundle\Entity\Server]  # Sets the controlled entity class
        calls:
            - [ setScmcAdm, ["@stsbl.scmc.service.scmcadm"] ]
            - [ setLogger, ["@iserv.logger"] ]
        tags:
            - { name: iserv.crud } # Tells IServ about our CRUD
    
    stsbl.scmc.menu_builder:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Menu\MenuBuilder
        arguments: ["@knp_menu.factory", "@security.token_storage", "@security.authorization_checker", "@event_dispatcher"]
        
    stsbl.scmc.service.scmcadm:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Service\ScmcAdm
        arguments: ["@iserv.shell", "@request_stack", "@iserv.security_handler", "@stsbl.scmc.security.scmcauth"]

    stsbl.scmc.validator.not_portalserver_domain:
        class: Stsbl\SchoolCertificateManagerConnectorBundle\Validator\Constraints\NotPortalServerDomainValidator
        arguments: ["@iserv.config"]
        tags:
            - { name: validator.constraint_validator, alias: stsbl_scmc_not_portalserver_domain_validator }